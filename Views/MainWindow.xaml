<Window x:Class="EncryptionMinerControl.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:EncryptionMinerControl.Views"
        xmlns:helpers="clr-namespace:EncryptionMinerControl.Helpers"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        mc:Ignorable="d"
        Title="MainWindow" Height="600" Width="900">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </Window.Resources>
    <Grid TextElement.Foreground="{DynamicResource MaterialDesignBody}"
          TextElement.FontWeight="Regular"
          TextElement.FontSize="13"
          TextOptions.TextFormattingMode="Ideal"
          TextOptions.TextRenderingMode="Auto"
          Background="{DynamicResource MaterialDesignPaper}"
          TextElement.FontFamily="{DynamicResource MaterialDesignFont}">
        
        <TabControl Style="{StaticResource MaterialDesignNavigationRailTabControl}" 
                    TabStripPlacement="Left">
            
            <!-- DASHBOARD TAB (NEW) -->
            <TabItem>
                <TabItem.Header>
                    <StackPanel Width="70">
                        <materialDesign:PackIcon Kind="ViewDashboard" Width="24" Height="24" HorizontalAlignment="Center"/>
                        <TextBlock Text="Dashboard" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                    </StackPanel>
                </TabItem.Header>
                
                <Grid Margin="30">
                    <StackPanel MaxWidth="800">
                        <!-- Summary Cards -->
                        <Grid Margin="0,0,0,30">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="30"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- XMRig Status Card -->
                            <materialDesign:Card Grid.Column="0" Padding="20" UniformCornerRadius="15">
                                <StackPanel HorizontalAlignment="Center">
                                    <materialDesign:PackIcon Kind="Cpu64Bit" Width="60" Height="60" Foreground="{DynamicResource PrimaryHueMidBrush}" Margin="0,0,0,10"/>
                                    <TextBlock Text="XMRig (CPU)" Style="{StaticResource MaterialDesignHeadline5TextBlock}" HorizontalAlignment="Center" Margin="0,0,0,10"/>
                                    <Border Background="{DynamicResource MaterialDesignDivider}" CornerRadius="10" Padding="15,5">
                                        <TextBlock Text="{Binding XmrigMiner.Status}" FontSize="20" FontWeight="Bold" Foreground="{DynamicResource SecondaryHueMidBrush}"/>
                                    </Border>
                                </StackPanel>
                            </materialDesign:Card>

                            <!-- Rigel Status Card -->
                            <materialDesign:Card Grid.Column="2" Padding="20" UniformCornerRadius="15">
                                <StackPanel HorizontalAlignment="Center">
                                    <materialDesign:PackIcon Kind="Gpu" Width="60" Height="60" Foreground="{DynamicResource SecondaryHueMidBrush}" Margin="0,0,0,10"/>
                                    <TextBlock Text="Rigel (GPU)" Style="{StaticResource MaterialDesignHeadline5TextBlock}" HorizontalAlignment="Center" Margin="0,0,0,10"/>
                                    <Border Background="{DynamicResource MaterialDesignDivider}" CornerRadius="10" Padding="15,5">
                                        <TextBlock Text="{Binding RigelMiner.Status}" FontSize="20" FontWeight="Bold" Foreground="{DynamicResource SecondaryHueMidBrush}"/>
                                    </Border>
                                </StackPanel>
                            </materialDesign:Card>
                        </Grid>

                        <!-- Idle Monitor Section -->
                        <materialDesign:Card Padding="30" UniformCornerRadius="10" Margin="0,0,0,30">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                                    <materialDesign:PackIcon Kind="TimerSand" Width="30" Height="30" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                    <TextBlock Text="Idle Monitor (For Mining)" Style="{StaticResource MaterialDesignHeadline5TextBlock}"/>
                                </StackPanel>
                                
                                <Grid Margin="0,0,0,10">
                                    <TextBlock Text="Time until Idle Mining Starts" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding CurrentIdleSeconds, StringFormat={}{0:F0}s / 60s}" HorizontalAlignment="Right" VerticalAlignment="Center" FontWeight="Bold"/>
                                </Grid>
                                
                                <ProgressBar Value="{Binding IdleProgress, Mode=OneWay}" Height="20" Foreground="{DynamicResource SecondaryHueMidBrush}" Background="{DynamicResource MaterialDesignDivider}"/>
                                
                                <TextBlock Text="* Mining starts automatically when the bar is full (no activity for 1 min)." 
                                           Margin="0,10,0,0" Opacity="0.6" FontStyle="Italic" HorizontalAlignment="Center"/>
                            </StackPanel>
                        </materialDesign:Card>

                        <!-- Keep Awake Monitor Section -->
                        <materialDesign:Card Padding="30" UniformCornerRadius="10" Visibility="{Binding IsKeepAwakeEnabled, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                                    <materialDesign:PackIcon Kind="Mouse" Width="30" Height="30" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                    <TextBlock Text="Keep Awake Monitor" Style="{StaticResource MaterialDesignHeadline5TextBlock}"/>
                                </StackPanel>

                                <Grid Margin="0,0,0,10">
                                    <TextBlock Text="Next Mouse Jiggle In" VerticalAlignment="Center"/>
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                        <TextBlock Text="{Binding TimeUntilNextJiggle, StringFormat={}{0:F0}s}" FontWeight="Bold"/>
                                        <TextBlock Text=" / "/>
                                        <TextBlock Text="{Binding KeepAwakeInterval, StringFormat={}{0}s}" FontWeight="Bold"/>
                                    </StackPanel>
                                </Grid>

                                <ProgressBar Value="{Binding KeepAwakeProgress, Mode=OneWay}" Height="20" Foreground="{DynamicResource PrimaryHueMidBrush}" Background="{DynamicResource MaterialDesignDivider}"/>

                                <TextBlock Text="* Prevents sleep mode by simulating mouse movement." 
                                           Margin="0,10,0,0" Opacity="0.6" FontStyle="Italic" HorizontalAlignment="Center"/>
                            </StackPanel>
                        </materialDesign:Card>
                    </StackPanel>
                </Grid>
            </TabItem>

            <!-- MONITORING TAB (MOVED) -->
            <TabItem>
                <TabItem.Header>
                    <StackPanel Width="70">
                        <materialDesign:PackIcon Kind="MonitorDashboard" Width="24" Height="24" HorizontalAlignment="Center"/>
                        <TextBlock Text="Monitoring" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                    </StackPanel>
                </TabItem.Header>
                
                <Grid Margin="20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="20"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- XMRig Card -->
                    <materialDesign:Card Grid.Column="0" Padding="10" UniformCornerRadius="10">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <!-- Header -->
                            <StackPanel Orientation="Horizontal" Grid.Row="0" Margin="0,0,0,10">
                                <materialDesign:PackIcon Kind="Cpu64Bit" Width="30" Height="30" VerticalAlignment="Center" Foreground="{DynamicResource PrimaryHueMidBrush}"/>
                                <TextBlock Text="XMRig (CPU)" Style="{StaticResource MaterialDesignHeadline5TextBlock}" Margin="10,0,0,0" VerticalAlignment="Center"/>
                            </StackPanel>
                            
                            <!-- Status -->
                            <Border Grid.Row="1" Background="{DynamicResource MaterialDesignDivider}" CornerRadius="5" Padding="10" Margin="0,0,0,10">
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <TextBlock Text="Status: " FontWeight="Bold"/>
                                    <TextBlock Text="{Binding XmrigMiner.Status}" FontWeight="Bold" Foreground="{DynamicResource SecondaryHueMidBrush}"/>
                                </StackPanel>
                            </Border>
                            
                            <!-- Log Viewer -->
                            <Border Grid.Row="2" Background="Black" CornerRadius="5" Padding="5" Margin="0,0,0,10">
                                <ListBox ItemsSource="{Binding XmrigMiner.Logs}" Background="Transparent" BorderThickness="0" 
                                         helpers:AutoScrollBehavior.AutoScroll="True"
                                         ScrollViewer.VerticalScrollBarVisibility="Auto" FontFamily="Consolas" FontSize="11">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding}" Foreground="#00FF00" TextWrapping="Wrap"/>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                            </Border>
                            
                            <!-- Controls -->
                            <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Center">
                                <Button Command="{Binding XmrigMiner.StartCommand}" Content="START" Margin="0,0,10,0" Style="{StaticResource MaterialDesignRaisedButton}"/>
                                <Button Command="{Binding XmrigMiner.StopCommand}" Content="STOP" Style="{StaticResource MaterialDesignOutlinedButton}" Foreground="Red" BorderBrush="Red"/>
                            </StackPanel>
                        </Grid>
                    </materialDesign:Card>
                    
                    <!-- Rigel Card -->
                    <materialDesign:Card Grid.Column="2" Padding="10" UniformCornerRadius="10">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Header -->
                            <StackPanel Orientation="Horizontal" Grid.Row="0" Margin="0,0,0,10">
                                <materialDesign:PackIcon Kind="Gpu" Width="30" Height="30" VerticalAlignment="Center" Foreground="{DynamicResource SecondaryHueMidBrush}"/>
                                <TextBlock Text="Rigel (GPU)" Style="{StaticResource MaterialDesignHeadline5TextBlock}" Margin="10,0,0,0" VerticalAlignment="Center"/>
                            </StackPanel>

                            <!-- Status -->
                            <Border Grid.Row="1" Background="{DynamicResource MaterialDesignDivider}" CornerRadius="5" Padding="10" Margin="0,0,0,10">
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <TextBlock Text="Status: " FontWeight="Bold"/>
                                    <TextBlock Text="{Binding RigelMiner.Status}" FontWeight="Bold" Foreground="{DynamicResource SecondaryHueMidBrush}"/>
                                </StackPanel>
                            </Border>

                            <!-- Log Viewer -->
                            <Border Grid.Row="2" Background="Black" CornerRadius="5" Padding="5" Margin="0,0,0,10">
                                <ListBox ItemsSource="{Binding RigelMiner.Logs}" Background="Transparent" BorderThickness="0"
                                         helpers:AutoScrollBehavior.AutoScroll="True"
                                         ScrollViewer.VerticalScrollBarVisibility="Auto" FontFamily="Consolas" FontSize="11">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding}" Foreground="#00BFFF" TextWrapping="Wrap"/>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                            </Border>

                            <!-- Controls -->
                            <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Center">
                                <Button Command="{Binding RigelMiner.StartCommand}" Content="START" Margin="0,0,10,0" Style="{StaticResource MaterialDesignRaisedButton}"/>
                                <Button Command="{Binding RigelMiner.StopCommand}" Content="STOP" Style="{StaticResource MaterialDesignOutlinedButton}" Foreground="Red" BorderBrush="Red"/>
                            </StackPanel>
                        </Grid>
                    </materialDesign:Card>
                </Grid>
            </TabItem>
            
            <!-- SETTINGS TAB -->
            <TabItem>
                 <TabItem.Header>
                    <StackPanel Width="70">
                        <materialDesign:PackIcon Kind="Cog" Width="24" Height="24" HorizontalAlignment="Center"/>
                        <TextBlock Text="Settings" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                    </StackPanel>
                </TabItem.Header>
                
                <ScrollViewer>
                    <StackPanel Margin="20" MaxWidth="800" HorizontalAlignment="Left">
                        
                        <!-- General Settings -->
                        <materialDesign:Card Padding="20" Margin="0,0,0,20">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                                    <materialDesign:PackIcon Kind="Tune" Width="24" Height="24" VerticalAlignment="Center"/>
                                    <TextBlock Text="General Settings" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Margin="10,0,0,0"/>
                                </StackPanel>

                                <CheckBox Content="Run on Windows Startup" 
                                          IsChecked="{Binding IsRunOnStartupEnabled}"
                                          Margin="0,0,0,10"/>

                                <CheckBox Content="Enable Idle Mining (Start after 1 min idle, Stop on activity)" 
                                          IsChecked="{Binding IsIdleMiningEnabled}"/>
                            </StackPanel>
                        </materialDesign:Card>

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                            <TextBlock Text="Configuration" Style="{StaticResource MaterialDesignHeadline4TextBlock}" VerticalAlignment="Center" Margin="0,0,20,0"/>
                            <Button Command="{Binding AutoConfigCommand}" Content="AUTO DETECT &amp; CONFIGURE" Style="{StaticResource MaterialDesignOutlinedButton}"/>
                        </StackPanel>
                        
                        <!-- XMRig Settings -->
                        <materialDesign:Card Padding="20" Margin="0,0,0,20">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                                    <materialDesign:PackIcon Kind="Cpu64Bit" Width="24" Height="24" VerticalAlignment="Center"/>
                                    <TextBlock Text="XMRig Settings" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Margin="10,0,0,0"/>
                                </StackPanel>
                                
                                <TextBox Text="{Binding XmrigMiner.Config.ExecutablePath}" materialDesign:HintAssist.Hint="Executable Path (e.g. C:\miners\xmrig.exe)" Style="{StaticResource MaterialDesignFloatingHintTextBox}" Margin="0,0,0,10"/>
                                <TextBox Text="{Binding XmrigMiner.Config.Algorithm}" materialDesign:HintAssist.Hint="Algorithm (Optional, e.g. rx/0)" Style="{StaticResource MaterialDesignFloatingHintTextBox}" Margin="0,0,0,10"/>
                                <TextBox Text="{Binding XmrigMiner.Config.PoolUrl}" materialDesign:HintAssist.Hint="Pool URL (stratum+tcp://...)" Style="{StaticResource MaterialDesignFloatingHintTextBox}" Margin="0,0,0,10"/>
                                <TextBox Text="{Binding XmrigMiner.Config.WalletAddress}" materialDesign:HintAssist.Hint="Wallet Address" Style="{StaticResource MaterialDesignFloatingHintTextBox}" Margin="0,0,0,10"/>
                                <TextBox Text="{Binding XmrigMiner.Config.ExtraArguments}" materialDesign:HintAssist.Hint="Extra Arguments" Style="{StaticResource MaterialDesignFloatingHintTextBox}" Margin="0,0,0,10"/>
                            </StackPanel>
                        </materialDesign:Card>
                        
                        <!-- Rigel Settings -->
                        <materialDesign:Card Padding="20" Margin="0,0,0,20">
                             <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                                    <materialDesign:PackIcon Kind="Gpu" Width="24" Height="24" VerticalAlignment="Center"/>
                                    <TextBlock Text="Rigel Settings" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Margin="10,0,0,0"/>
                                </StackPanel>

                                <TextBox Text="{Binding RigelMiner.Config.ExecutablePath}" materialDesign:HintAssist.Hint="Executable Path (e.g. C:\miners\rigel.exe)" Style="{StaticResource MaterialDesignFloatingHintTextBox}" Margin="0,0,0,10"/>
                                <TextBox Text="{Binding RigelMiner.Config.Algorithm}" materialDesign:HintAssist.Hint="Algorithm (e.g. alephium)" Style="{StaticResource MaterialDesignFloatingHintTextBox}" Margin="0,0,0,10"/>
                                <TextBox Text="{Binding RigelMiner.Config.PoolUrl}" materialDesign:HintAssist.Hint="Pool URL (stratum+tcp://...)" Style="{StaticResource MaterialDesignFloatingHintTextBox}" Margin="0,0,0,10"/>
                                <TextBox Text="{Binding RigelMiner.Config.WalletAddress}" materialDesign:HintAssist.Hint="Wallet Address" Style="{StaticResource MaterialDesignFloatingHintTextBox}" Margin="0,0,0,10"/>
                                <TextBox Text="{Binding RigelMiner.Config.ExtraArguments}" materialDesign:HintAssist.Hint="Extra Arguments" Style="{StaticResource MaterialDesignFloatingHintTextBox}" Margin="0,0,0,10"/>
                             </StackPanel>
                        </materialDesign:Card>
                        
                        <StackPanel Orientation="Horizontal" Margin="0,20,0,0">
                            <Button Command="{Binding SaveConfigCommand}" Content="SAVE SETTINGS" Width="150" Margin="0,0,20,0"/>
                            <Button Command="{Binding AutoConfigCommand}" Content="AUTO DETECT" Style="{StaticResource MaterialDesignOutlinedButton}" Width="150" Margin="0,0,20,0"/>
                            <Button Command="{Binding ResetConfigCommand}" Content="RESET TO BATCH" Style="{StaticResource MaterialDesignOutlinedButton}" BorderBrush="OrangeRed" Foreground="OrangeRed"/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>
    </Grid>
</Window>
